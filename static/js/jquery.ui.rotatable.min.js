(function(d,k){function f(a){e(a,0);var b=a.offset();e(a,a.data("angle"));var c=b.left+a.width()/2;a=b.top+a.height()/2;return[c,a]}function e(a,b){a.css("transform","rotate("+b+"rad)");a.css("-moz-transform","rotate("+b+"rad)");a.css("-webkit-transform","rotate("+b+"rad)");a.css("-o-transform","rotate("+b+"rad)")}function l(a){if(c)return!1}function m(a){if(!c)return!1;var b=f(c);a=Math.atan2(a.pageY-b[1],a.pageX-b[0])-g+h;e(c,a);c.data("angle",a);return!1}function n(a){c=d(this).parent();var b= f(c);g=Math.atan2(a.pageY-b[1],a.pageX-b[0]);h=c.data("angle");d(document).on("mousemove",m);return!1}d.widget("ui.rotatable",d.ui.mouse,{options:{handle:!1},handle:function(a){if(a===k)return this.options.handle;this.options.handle=a},_create:function(){var a=d(document.createElement("div"));a.addClass("ui-rotatable-handle");a.draggable({helper:"clone",start:l});a.on("mousedown",n);a.appendTo(this.element);this.options.handle=a;this.element.data("angle",0)}});var c,g,h;d(document).on("mouseup",function(a){if(c)return d(document).unbind("mousemove"), setTimeout(function(){c=!1},10),!1})})(jQuery);